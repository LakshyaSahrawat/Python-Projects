<!DOCTYPE html>
<html>
<head>
    <title>FastAPI Task App</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container py-5">

    <h2 class="mb-4">FastAPI Task App</h2>

    <div class="row mb-4">
        <div class="col-md-6">
            <h4>Register</h4>
            <input id="reg_username" class="form-control mb-2" placeholder="Username">
            <input id="reg_password" type="password" class="form-control mb-2" placeholder="Password">
            <button class="btn btn-primary" onclick="register()">Register</button>
        </div>

        <div class="col-md-6">
            <h4>Login</h4>
            <input id="login_username" class="form-control mb-2" placeholder="Username">
            <input id="login_password" type="password" class="form-control mb-2" placeholder="Password">
            <button class="btn btn-success" onclick="login()">Login</button>
        </div>
    </div>

    <div class="mb-4">
        <h4>Create Task</h4>
        <input id="task_title" class="form-control mb-2" placeholder="Title">
        <input id="task_description" class="form-control mb-2" placeholder="Description">
        <input id="task_priority" class="form-control mb-2" placeholder="Priority">
        <button class="btn btn-warning" onclick="createTask()">Create Task</button>
    </div>

    <div class="mb-4">
        <button class="btn btn-info mb-2" onclick="loadTasks()">Load Tasks</button>
        <ul id="task_list" class="list-group"></ul>
    </div>

    <div id="message" class="mt-3"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let token = "";

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `alert alert-${type}`;
        }

        function register() {
            fetch('/register', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    username: document.getElementById('reg_username').value,
                    password: document.getElementById('reg_password').value
                })
            }).then(r => r.json()).then(data => {
                if (data.id) {
                    showMessage('Registration successful!', 'success');
                } else {
                    showMessage('Registration failed.', 'danger');
                }
            });
        }

        function login() {
            const formData = new URLSearchParams();
            formData.append('username', document.getElementById('login_username').value);
            formData.append('password', document.getElementById('login_password').value);

            fetch('/token', {
                method: 'POST',
                body: formData
            }).then(r => r.json()).then(data => {
                if (data.access_token) {
                    token = data.access_token;
                    showMessage('Login successful!', 'success');
                } else {
                    showMessage('Login failed.', 'danger');
                }
            });
        }

        function createTask() {
            fetch('/tasks/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                },
                body: JSON.stringify({
                    title: document.getElementById('task_title').value,
                    description: document.getElementById('task_description').value,
                    priority: document.getElementById('task_priority').value
                })
            }).then(r => r.json()).then(data => {
                if (data.id) {
                    showMessage('Task created!', 'success');
                    loadTasks();
                } else {
                    showMessage('Failed to create task.', 'danger');
                }
            });
        }

        function loadTasks() {
            fetch('/tasks/', {
                headers: {'Authorization': 'Bearer ' + token}
            }).then(r => r.json()).then(data => {
                const list = document.getElementById('task_list');
                list.innerHTML = '';
                data.forEach(task => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item d-flex justify-content-between align-items-center';
                    li.textContent = `${task.title} - ${task.status}`;
                    list.appendChild(li);
                });
            });
        }
    </script>
</body>
</html>