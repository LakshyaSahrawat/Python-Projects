<!-- templates/tasks.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Tasks</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container py-5">
    <h2>Task Management</h2>

    <div class="mb-4">
        <h4>Create Task</h4>
        <input id="task_title" class="form-control mb-2" placeholder="Title">
        <input id="task_description" class="form-control mb-2" placeholder="Description">
        <input id="task_priority" class="form-control mb-2" placeholder="Priority">
        <button class="btn btn-warning" onclick="createTask()">Create Task</button>
    </div>

    <div class="mb-4">
        <button class="btn btn-info mb-2" onclick="loadTasks()">Load Tasks</button>
        <ul id="task_list" class="list-group"></ul>
    </div>

    <button class="btn btn-danger" onclick="logout()">Logout</button>

    <div id="message" class="mt-3"></div>

    <script>
        const token = localStorage.getItem('token');
        if (!token) window.location.href = '/login';

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `alert alert-${type}`;
        }

        function createTask() {
            fetch('/task/tasks/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                },
                body: JSON.stringify({
                    title: document.getElementById('task_title').value,
                    description: document.getElementById('task_description').value,
                    priority: document.getElementById('task_priority').value
                })
            }).then(r => r.json()).then(data => {
                if (data.id) {
                    showMessage('Task created!', 'success');
                    loadTasks();
                } else {
                    showMessage('Failed to create task.', 'danger');
                }
            });
        }

        function loadTasks() {
            fetch('/task/tasks/', {
                headers: {'Authorization': 'Bearer ' + token}
            }).then(r => r.json()).then(data => {
                const list = document.getElementById('task_list');
                list.innerHTML = '';
                data.forEach(task => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item d-flex justify-content-between align-items-center';
                    li.textContent = `${task.title} - ${task.status}`;
                    list.appendChild(li);
                });
            });
        }

        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/login';
        }

        window.onload = loadTasks;
    </script>
</body>
</html>
